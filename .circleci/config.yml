version: 2
jobs:
  maven/test:
    docker:
    - image: docker:17.05.0-ce-git
    steps:
    - checkout
    - setup_remote_docker
    #- run:
    #    name: Generate Cache Checksum
    #    command: find . -name 'pom.xml' | sort | xargs cat > /tmp/maven_cache_seed
    #- restore_cache:
    #    key: maven-{{ checksum "/tmp/maven_cache_seed" }}
    #    
    #- run:
    #    name: Install Dependencies
    #    command: mvn -DskipTests clean install dependency:resolve-plugins dependency:go-offline
        
    - run:
        name: Install apt-get
        command: |
            docker info
            # sudo: not found 
            apt-get update -y 
            apt-get upgrade -y 
            apt-get install tightvncserver xfonts-base
            # setup_remote_docker: command not found
            docker run hello-world
        
    - run:
        name: Run Docker
        command: |
            ./model/src/test/resources/docker/script/build.sh
            ./model/src/test/resources/docker/script/run.sh
            ./model/src/test/resources/docker/script/buff.sh
            ./model/src/test/resources/docker/script/verify.sh 
                   
    #- run:
    #    name: Run Tests
    #    command: ./model/src/test/resources/vnc/execute-on-vnc.sh mvn clean verify
    #        
    #- run:
    #    name: Run Tests
    #    command: ./model/src/test/resources/docker/script/verify.sh
    #
    #- save_cache:
    #    paths:
    #    - ~/.m2
    #    key: maven-{{ checksum "/tmp/maven_cache_seed" }}
    #- store_test_results:
    #    path: target/surefire-reports
workflows:
  maven_test:
    jobs:
    - maven/test
  version: 2
  
general:
  branches:
    only:
     - circleci-master